#!/bin/bash

if [[ $# -lt 2 ]]; then
   echo "Usage: $0 <JSON file> <YAML file>"
   echo
   echo "Please make sure that <YAML file> doesn't already exist, this program will not clobber it"
   exit 1
fi

if [[ ! -r "$1" ]]; then
   echo "Source JSON file $1 is not readable"
   exit 1
fi

if [[ -e "$2" ]]; then
   echo "Output YAML file $2 already exists, refusing to clobber"
   exit 1
fi

ruby -ryaml -rjson -e 'puts YAML::dump(JSON.load(ARGF))' < "$1" > "$2"
if [[ $? -eq 0 ]]; then
   echo "Successfully wrote YAML to $2"
else
   echo
   echo "Ruby had a non-zero exit status. Please check for parse errors and try again"
fi
